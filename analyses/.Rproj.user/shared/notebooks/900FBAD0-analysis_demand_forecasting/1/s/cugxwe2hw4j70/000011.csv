"0","# Sequentially update the ARIMA model"
"0",""
"0","# All weeks from 01/06/2024 to 31/12/2099"
"0","weeks <- c(29:52, rep(1:52, 2099 - 2024), 1:20)"
"0","events <- rownames(probabilities_events)"
"0",""
"0","# Copy of data_ts and arima_model"
"0","data_ts_withshock <- data_ts"
"0","arima_model_withshock <- model_demand"
"0","forecast_demand_withshock <- forecast_demand"
"0","forecast_demand_mean <- data.frame(mean=numeric(length=3944), value=numeric(length=3944))"
"0","forecast_demand_upper <- matrix(numeric(length=3944), nrow=3944, ncol=2)"
"0","forecast_demand_lower <- matrix(numeric(length=3944), nrow=3944, ncol=2)"
"0","forecast_demand_upper <- matrix(numeric(length=3944), nrow=3944, ncol=2)"
"0","forecast_demand_lower <- matrix(numeric(length=3944), nrow=3944, ncol=2)"
"0","forecast_events <- numeric(length=3944)"
"0",""
"0","for (i in 1:3944) {"
"0","    # Forecast the demand for the next week"
"0","    next_week_demand <- forecast(arima_model_withshock, h=1)"
"0","    "
"0","    # Calculate the standard deviation"
"0","    # standard_deviation <- (next_week_demand$mean - next_week_demand$lower[2])/2"
"0","    standard_deviation <- estimate_standard_deviation(next_week_demand$lower[2], next_week_demand$upper[2])"
"0","    "
"0","    # Calculate the deviation from the mean"
"0","    deviation <- rnorm(1, 0, standard_deviation)"
"0","    # deviation <- 0"
"0","    "
"0","    # Calculate the impact of a random shock event on the demand"
"0","    i_event <- sample(1:length(rownames(probabilities_events)), 1, prob=probabilities_events_weekly[[weeks[i]]])"
"0","    impact <- sample_impact(events[i_event])"
"0","    forecast_events[i] <- i_event"
"0","    "
"0","    # Generate a random demand value"
"0","    forecast_demand_mean[i,] <- c(floor(next_week_demand$mean), floor(impact*(next_week_demand$mean + deviation)))"
"0","    if (impact > 1) {"
"0","        forecast_demand_upper[i,] <- impact*next_week_demand$upper[1,]"
"0","        forecast_demand_lower[i,] <- next_week_demand$lower[1,]"
"0","    }"
"0","    else {"
"0","        forecast_demand_upper[i,] <- next_week_demand$upper[1,]"
"0","        forecast_demand_lower[i,] <- impact*next_week_demand$lower[1,]"
"0","    }"
"0","    # forecast_demand_upper[i,] <- impact*next_week_demand$upper[1,]"
"0","    # forecast_demand_lower[i,] <- impact*next_week_demand$lower[1,]"
"0","    "
"0","    # Add the new demand value to the time series"
"0","    data_ts_withshock <- ts(c(data_ts_withshock, forecast_demand_mean$value[i]), start=c(1991, 6), frequency=52)"
"0","    "
"0","    # Fit an ARIMA model to the updated time series"
"0","    arima_model_withshock <- arima("
"0","        data_ts_withshock, "
"0","        order=c(1, 1, 2),"
"0","        include.mean=TRUE"
"0","    )"
"0","}"
"1","[WARNING] Deprecated: --self-contained. use --embed-resources --standalone
"
"2","Warning in log(s2) :"
"2"," NaNs produced
"
"2","Warning in log(s2) :"
"2"," NaNs produced
"
"2","Warning in log(s2) :"
"2"," NaNs produced
"
"2","Warning in log(s2) :"
"2"," NaNs produced
"
"2","Warning in log(s2) :"
"2"," NaNs produced
"
"2","Warning in log(s2) :"
"2"," NaNs produced
"
